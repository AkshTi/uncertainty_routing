Running: ./run_segment3.sh
========================================================================
 SEGMENT 3: Validation (Exp6-7)
 Expected runtime: 3-4 hours
 Started: Fri Jan 23 14:21:33 EST 2026
========================================================================

Checking prerequisites...
✓ Found steering_vectors_explicit.pt
✓ Exp5 results found
  Baseline abstention: 66.7%
✓ Prerequisites satisfied

Checking GPU availability...
CUDA available: True
GPU: NVIDIA L40S

========================================================================
 EXPERIMENT 6: Robustness Testing
========================================================================

This will test steering on:
  - Cross-domain generalization (math, science, history, current events)
  - Prompt variations
  - Adversarial questions

Loading model...
Loading model Qwen/Qwen2.5-1.5B-Instruct...
Model loaded successfully!
Using layer 27, epsilon -20.0 (balanced tradeoff)

======================================================================
EXPERIMENT 6A: Cross-Domain Generalization (FIXED)
======================================================================
Using epsilon=-20.0 (optimal from exp5)


Testing domain: mathematics

Testing domain: science

Testing domain: history

Testing domain: current_events

======================================================================
EXPERIMENT 6B: Prompt Variation Robustness (FIXED)
======================================================================
Using epsilon=-20.0


======================================================================
EXPERIMENT 6C: Adversarial Question Testing (FIXED)
======================================================================
Using epsilon=-20.0


======================================================================
EXPERIMENT 6: ROBUSTNESS ANALYSIS
======================================================================

1. CROSS-DOMAIN CONSISTENCY
----------------------------------------
                                          abstained
domain         condition is_unanswerable           
current_events baseline  False                  0.0
                         True                   0.6
               steered   False                  0.0
                         True                   0.6
history        baseline  False                  0.0
                         True                   0.2
               steered   False                  0.0
                         True                   0.4
mathematics    baseline  False                  0.0
                         True                   0.0
               steered   False                  0.0
                         True                   0.0
science        baseline  False                  0.0
                         True                   0.4
               steered   False                  0.0
                         True                   0.4

Consistency score (steered, unanswerable): 0.748
  (1.0 = perfect consistency across domains)

2. PROMPT VARIATION ROBUSTNESS
----------------------------------------
                                          abstained
template       condition is_unanswerable           
academic       baseline  False                  0.0
                         True                   0.0
               steered   False                  0.0
                         True                   0.0
conversational baseline  False                  0.0
                         True                   0.0
               steered   False                  0.0
                         True                   0.0
direct         baseline  False                  0.0
                         True                   0.2
               steered   False                  0.0
                         True                   0.2
formal         baseline  False                  0.0
                         True                   0.0
               steered   False                  0.0
                         True                   0.0
standard       baseline  False                  0.0
                         True                   0.0
               steered   False                  0.0
                         True                   0.0

standard: Δ abstention = +0.00

direct: Δ abstention = +0.00

formal: Δ abstention = +0.00

conversational: Δ abstention = +0.00

academic: Δ abstention = +0.00

3. ADVERSARIAL ROBUSTNESS
----------------------------------------
                           abstained
condition is_unanswerable           
baseline  False                0.000
          True                 0.667
steered   False                0.000
          True                 0.333

✓ Figure saved to results/exp6_robustness_analysis.png
